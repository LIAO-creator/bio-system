<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA的秘密</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f9;
        }

        h1 {
            color: #4CAF50;
        }

        p {
            font-size: 18px;
            color: #333;
        }

        a {
            font-size: 20px;
            color: #007BFF;
            text-decoration: none;
        }

        .button {
            font-size: 20px;
            color: white;
            background-color: #4CAF50;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 30px;
        }

        .button:hover {
            background-color: #45a049;
        }

        #gameContainer {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }

        canvas {
            background-color: #e6e6ff;
            border: 2px solid #333;
        }

        .score, .target-text {
            font-size: 25px;
            margin-top: 20px;
            color: #333;
        }
    </style>
</head>
<body>

    <!-- 页面标题和介绍部分 -->
    <h1>点击这里了解DNA的秘密</h1>
    <p>DNA，作为生命的遗传密码，包含了生物体的重要信息。点击下方链接，探索更多关于DNA的精彩内容！</p>
    <a href="https://liao-creator.github.io/bio-system/dna-page.html">继续探索</a>

    <!-- 游戏按钮 -->
    <button class="button" onclick="startGame()">进入核苷酸拼装游戏</button>

    <!-- 游戏画布容器 -->
    <div id="gameContainer" style="display: none;">
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- 游戏相关的脚本 -->
    <script src="game.js"></script>

    <script>
        // 定义是否显示游戏的变量
        function startGame() {
            // 隐藏介绍部分
            document.querySelector('h1').style.display = 'none';
            document.querySelector('p').style.display = 'none';
            document.querySelector('a').style.display = 'none';
            document.querySelector('.button').style.display = 'none';

            // 显示游戏部分
            document.getElementById('gameContainer').style.display = 'block';

            // 调用游戏初始化代码
            loadImages().then(() => {
                initComponents();
                gameLoop();
            });
        }

        // 游戏参数
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let WIDTH = window.innerWidth * 0.9;
        let HEIGHT = window.innerHeight * 0.6;
        const FPS = 30;
        let score = 0;
        let timeLeft = 60;
        let startTime = Date.now();
        const font = '40px Arial';
        const BACKGROUND_COLOR = 'rgb(230, 230, 255)';
        const WHITE = 'rgb(255, 255, 255)';
        const BLACK = 'rgb(0, 0, 0)';
        const GREEN = 'rgb(34, 177, 76)';
        canvas.width = WIDTH;
        canvas.height = HEIGHT;

        const baseImages = {
            A: 'base_A.png',
            T: 'base_T.png',
            C: 'base_C.png',
            G: 'base_G.png',
            U: 'base_U.png'
        };

        let images = {};
        let components = [];

        const NUCLEOTIDES = {
            'A-T': [['A', 'T']],
            'C-G': [['C', 'G']],
            'A-U': [['A', 'U']],
            'G-C': [['G', 'C']]
        };

        class DraggableComponent {
            constructor(image, x, y, name) {
                this.image = image;
                this.x = x;
                this.y = y;
                this.name = name;
                this.width = 100;
                this.height = 100;
                this.dragging = false;
            }

            draw() {
                ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
            }

            startDrag() {
                this.dragging = true;
            }

            stopDrag() {
                this.dragging = false;
            }

            updatePosition(mouseX, mouseY) {
                if (this.dragging) {
                    this.x = mouseX - this.width / 2;
                    this.y = mouseY - this.height / 2;
                }
            }

            contains(x, y) {
                return x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height;
            }
        }

        function loadImages() {
            const promises = [];
            for (let key in baseImages) {
                promises.push(new Promise((resolve) => {
                    const img = new Image();
                    img.src = baseImages[key];
                    img.onload = () => {
                        images[key] = img;
                        resolve();
                    };
                }));
            }
            return Promise.all(promises);
        }

        function initComponents() {
            let x = 50;
            let y = 150;
            components.push(new DraggableComponent(images.A, x, y, 'A'));
            components.push(new DraggableComponent(images.T, x + 120, y, 'T'));
            components.push(new DraggableComponent(images.C, x + 240, y, 'C'));
            components.push(new DraggableComponent(images.G, x + 360, y, 'G'));
            components.push(new DraggableComponent(images.U, x + 480, y, 'U'));
        }

        function gameLoop() {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            timeLeft = 60 - elapsedTime;

            if (timeLeft <= 0) {
                endGame('游戏结束!');
                return;
            }

            ctx.fillStyle = BACKGROUND_COLOR;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);

            ctx.strokeStyle = GREEN;
            ctx.lineWidth = 2;
            ctx.strokeRect(WIDTH / 2 - 200, HEIGHT / 2 + 50, 400, 200);

            ctx.fillStyle = BLACK;
            ctx.font = font;
            ctx.fillText(`时间: ${timeLeft}秒`, 10, 40);

            ctx.fillText(`分数: ${score}`, WIDTH - 150, 40);

            const targetText = getNewTargetText();
            ctx.fillText(`目标: ${targetText}`, WIDTH / 2 - ctx.measureText(targetText).width / 2, 50);

            components.forEach((component) => component.draw());

            requestAnimationFrame(gameLoop);
        }

        function getNewTargetText() {
            const allTargets = Object.keys(NUCLEOTIDES);
            const randomTarget = allTargets[Math.floor(Math.random() * allTargets.length)];
            return randomTarget;
        }

        function checkAssembly(component, targetComponents) {
            for (let target of targetComponents) {
                if (component.name === target[0]) {
                    return true;
                }
            }
            return false;
        }

        function endGame(message) {
            ctx.fillStyle = WHITE;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = BLACK;
            ctx.font = '50px Arial';
            ctx.fillText(message, WIDTH / 2 - ctx.measureText(message).width / 2, HEIGHT / 2);
        }

        let isMouseDown = false;
        let draggedComponent = null;

        canvas.addEventListener('mousedown', (event) => {
            isMouseDown = true;
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            components.forEach((component) => {
                if (component.contains(mouseX, mouseY)) {
                    draggedComponent = component;
                    component.startDrag();
                }
            });
        });

        canvas.addEventListener('mousemove', (event) => {
            if (draggedComponent && isMouseDown) {
                draggedComponent.updatePosition(event.offsetX, event.offsetY);
            }
        });

        canvas.addEventListener('mouseup', () => {
            if (draggedComponent) {
                draggedComponent.stopDrag();
                draggedComponent = null;
            }
            isMouseDown = false;
        });
    </script>
</body>
</html>
